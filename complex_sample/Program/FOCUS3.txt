-* FOCUS3.fex
-SET &ECHO = ALL;
SET NODATA = ' ';
SET HOLDLIST = PRINTONLY
EX FOCDATE

-* a) Join TOPEMP, BANKDETL, EMPADDR on EMPID (EMP_ID alias if needed)
DEFINE FILE TOPEMP
  EMP_ID/A20 = EMPID;
END
DEFINE FILE BANKDETL
  EMP_ID/A20 = EMPID;
END
DEFINE FILE EMPADDR
  EMP_ID/A20 = EMPID;
END

JOIN LEFT_OUTER EMP_ID IN TOPEMP   TO BANKDETL.EMP_ID IN BANKDETL AS J_TOP_BANK3;
JOIN LEFT_OUTER EMP_ID IN TOPEMP   TO EMPADDR.EMP_ID  IN EMPADDR  AS J_TOP_ADDR3;

-* b, c) Define BONUS_AMT and produce BONUSFILE (issues) and CHKFIL
TABLE FILE TOPEMP
  PRINT BANKDETL.* TOPEMP.*
  COMPUTE BONUS_AMT/D12.2 = 30000;
  WHERE (BANKDETL.INVALID_BANKCODE EQ 'Y') OR (BANKDETL.IN_NETWORK EQ 'N');
  ON TABLE HOLD AS CHKFIL FORMAT FOCUS
END
-RUN

JOIN CLEAR *
-RUN

-* d) Excel report for CHKFIL
SET ODS EXCEL ON
SET ODS EXCEL FORMAT=AUTO
TABLE FILE CHKFIL
  HEADING
  "Bank/Network Issues (Invalid Bankcode = Y OR In-Network = N)"
  "Generated: <+0>&YYMD"
  PRINT *
  ON TABLE XCL3 FORMAT XLSX
  ON TABLE SET SHEETNAME 'Bank Issues'
  ON TABLE SET STYLE *
    TYPE=HEADING, STYLE=BOLD, SIZE=12, JUSTIFY=CENTER, $
    TYPE=TITLE,   STYLE=BOLD, $
  ENDSTYLE
END
SET ODS EXCEL OFF
